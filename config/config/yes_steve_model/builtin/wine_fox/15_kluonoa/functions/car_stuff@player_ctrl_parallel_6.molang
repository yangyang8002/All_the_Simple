// 车辆显示控制
v.show_car=v.roaming.car && !(ctrl.tac_hold_gun||ctrl.playing_extra_animation||ctrl.carryon_is_princess);

v.show_car&&(ctrl.walk||ctrl.run||ctrl.jump) ? {
    // 轮胎旋转
    t.speed_frame=math.sqrt(math.pow(q.position_delta(0),2) + math.pow(q.position_delta(2),2))*math.pi*40;
    ysm.input_vertical<0 ? {
        v.wheel_rotate=math.min_angle(v.wheel_rotate-t.speed_frame);    // 后退
    } : {
        v.wheel_rotate=math.min_angle(v.wheel_rotate+t.speed_frame);    // 前进
    };
    // 随机鸣笛
    !v.roaming.car_can_horn && !v.roaming.horn_checker ? {
        math.mod(q.anim_time,2) <=1 ? {     // 2秒检测一次
            v.horn_check1=0;
        } : {
            t.horn_check=1;
            v.horn_check1!=t.horn_check ? {
                v.horn_counter=v.horn_counter+math.random_integer(0,2);     // 计数器随机增长
                v.horn_counter>=10 ? {      // 计数器累积到10时，鸣笛一次
                    ysm.play_sound('horn','horn');
                    v.horn_counter=0;
                };
            };
            v.horn_check1=t.horn_check;
        };
    };
};

// 按键鸣笛
ysm.keyboard(258)!=v.roaming.horn_checker && !v.roaming.car_can_horn1 && v.show_car && v.anim_ctrl ? {     // Tab键状态变换检测
    ysm.keyboard(258)==1 ? {    // 当Tab键按下时
        ysm.sync(0,0);
    } : {
        ysm.sync(0,1);
    };
};
v.roaming.horn_checker!=v.horn_checker1 ? {
    v.roaming.horn_checker==1 ? {
        ysm.play_sound('horn_long','horn_long');
        ysm.stop_sound('horn');
    } : {
        ysm.stop_sound('horn_long');
    };
    v.horn_checker1=v.roaming.horn_checker;
};
